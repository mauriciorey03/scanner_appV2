<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registrar Facturas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
        body {
            margin: 0;
            font-family: 'Montserrat', Arial, sans-serif;
            background: #eaeaea;
        }
        .main-container {
            display: flex;
            height: 100vh;
        }
        .left-panel {
            background: #204b92;
            color: #fff;
            flex: 1.1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            padding-right: 40px;
            min-width: 340px;
        }
        .left-content {
            max-width: 420px;
        }
        .left-panel h2 {
            font-size: 2.3rem;
            font-weight: 700;
            margin-bottom: 14px;
            line-height: 1.09;
        }
        .left-panel p {
            font-size: 1.12rem;
            font-weight: 400;
            color: #d8e2f1;
        }
        .right-panel {
            background: #efefef;
            flex: 1.4;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-width: 380px;
        }
        .form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 370px;
        }
        .input-box {
            width: 95%;
            height: 50px;
            border-radius: 12px;
            border: 1.5px solid #c5c5c5;
            margin-bottom: 35px;
            font-size: 2rem;
            text-align: center;
            background: #fff;
            outline: none;
            letter-spacing: 2px;
            color: #204b92;
        }
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 22px;
            width: 100%;
            margin-bottom: 28px;
        }
        .key {
            background: #fff;
            border: 1.5px solid #d1d1d1;
            border-radius: 18px;
            font-size: 2rem;
            color: #204b92;
            font-weight: 700;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(60,60,90,0.09);
            user-select: none;
            transition: background 0.12s, transform 0.09s;
        }
        .key:active {
            background: #dde8fa;
            transform: scale(0.97);
        }
        .buttons-row {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .btn {
            border: none;
            border-radius: 8px;
            padding: 10px 22px;
            font-size: 1.1rem;
            font-family: 'Montserrat', Arial, sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.13s;
        }
        .btn-confirmar {
            background: #0a2660;
            color: #fff;
            margin-right: 10px;
        }
        .btn-confirmar:hover {
            background: #163c91;
        }
        .btn-limpiar {
            background: #c4e014;
            color: #204b92;
        }
        .btn-limpiar:hover {
            background: #d3f324;
        }
        .factura-lista {
            width: 100%;
            margin: 30px 0 15px 0;
        }
        .factura-card {
            background: linear-gradient(120deg,#e8f1fa 70%, #cbe0fa 100%);
            border-radius: 14px;
            border: 2px solid #c4e014;
            box-shadow: 0 2px 12px rgba(60,60,90,0.12);
            padding: 18px 20px 12px 20px;
            margin-bottom: 13px;
            font-size: 1.07rem;
            color: #204b92;
            transition: box-shadow 0.18s;
        }
        .factura-card:hover {
            box-shadow: 0 6px 24px rgba(32,75,146,0.16);
        }
        .factura-card .campo {margin-bottom: 4px;}
        .cedula-tag {
            background: #c4e014;
            color: #204b92;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.99rem;
            font-weight: 600;
            margin-left: 5px;
        }
        .acciones-facturas {
            display: flex;
            justify-content: flex-end;
            gap: 14px;
            margin-top: 10px;
        }
        .btn-exito {
            background: #c4e014;
            color: #204b92;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1.2rem;
            margin-top: 28px;
            border: none;
            text-align: center;
            font-weight: 700;
        }
        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }
            .left-panel, .right-panel {
                min-width: unset;
                width: 100vw;
            }
            .left-panel {
                padding-right: 0;
                align-items: center;
                padding: 30px 0;
            }
            .right-panel {
                padding: 24px 0;
            }
        }
        @media (max-width: 480px) {
            .form-container {
                width: 95vw;
            }
            .input-box {
                font-size: 1.3rem;
            }
            .key {
                height: 50px;
                font-size: 1.3rem;
            }
            .btn, .btn-exito {
                font-size: 1rem;
                padding: 10px 13px;
            }
        }
    </style>
</head>
<body>
<div class="main-container">
    <div class="left-panel">
        <div class="left-content">
            <h2>
                Para registrar tus facturas, por favor<br>
                digita tu número de cédula.
            </h2>
            <p>
                Una vez que lo hagas, el sistema te guiará para escanear tus compras.
            </p>
        </div>
    </div>
    <div class="right-panel">
        <div class="form-container" id="form-cedula-area">
            <input type="text" id="cedulaInput" class="input-box" maxlength="15" readonly placeholder="Ingresa tu cédula">
            <div class="keypad">
                <div class="key" data-key="1">1</div>
                <div class="key" data-key="2">2</div>
                <div class="key" data-key="3">3</div>
                <div class="key" data-key="4">4</div>
                <div class="key" data-key="5">5</div>
                <div class="key" data-key="6">6</div>
                <div class="key" data-key="7">7</div>
                <div class="key" data-key="8">8</div>
                <div class="key" data-key="9">9</div>
                <div class="key" style="visibility: hidden"></div>
                <div class="key" data-key="0">0</div>
                <div class="key" id="backspace">&larr;</div>
            </div>
            <div class="buttons-row">
                <button class="btn btn-confirmar" id="confirmarBtn" disabled>Confirmar Cedula</button>
                <button class="btn btn-limpiar" id="limpiarBtn" disabled>Limpiar campos</button>
            </div>
        </div>
        <div id="panel-facturas" style="display:none; width:100%;">
            <div style="text-align:center;margin-bottom:8px;">
                <span style="font-weight:500">Cédula asociada:</span>
                <span class="cedula-tag" id="cedula-asociada"></span>
            </div>
            <div class="factura-lista" id="factura-lista"></div>
            <div class="acciones-facturas">
                <button class="btn btn-limpiar" id="btnOtraFactura">Añadir otra factura</button>
                <button class="btn btn-confirmar" id="btnFinalizar">Confirmar y finalizar</button>
            </div>
        </div>
        <div id="mensaje-exito" style="display:none;">
            <div class="btn-exito">
                ¡Facturas enviadas con éxito!<br>
                Gracias por tu registro.
            </div>
        </div>
    </div>
</div>
<script src="demo.js"></script>
<script>
    console.log("Demo.js cargado correctamente.");
    if (!window.ejemplos || !Array.isArray(window.ejemplos)) {
        console.error("No se encontraron datos de ejemplo en demo.js.");
    } else {
        console.log(`Se encontraron ${window.ejemplos.length} ejemplos de facturas.`);
    }   
    
    // Aquí usas window.ejemplos o ejemplos directamente
    console.log('ejemplos:', ejemplos); // Esto debe mostrar el arreglo en consola

</script>

<script>
    // === Teclado numérico ===
    const input = document.getElementById('cedulaInput');
    const keys = document.querySelectorAll('.key[data-key]');
    const backspace = document.getElementById('backspace');
    const confirmarBtn = document.getElementById('confirmarBtn');
    const limpiarBtn = document.getElementById('limpiarBtn');
    let cedulaActual = "";
    let facturas = [];

    function actualizarBotones() {
        confirmarBtn.disabled = !(input.value.length >= 6);
        limpiarBtn.disabled = !(input.value.length >= 1);
    }
    keys.forEach(key => {
        key.addEventListener('click', () => {
            if (input.value.length < input.maxLength) {
                input.value += key.dataset.key;
                actualizarBotones();
            }
        });
    });
    backspace.addEventListener('click', () => {
        input.value = input.value.slice(0, -1);
        actualizarBotones();
    });
    limpiarBtn.addEventListener('click', () => {
        input.value = "";
        actualizarBotones();
    });
    input.addEventListener('input', actualizarBotones);

    // === Confirmar Cedula ===
    confirmarBtn.addEventListener('click', () => {
        if (input.value.length < 6) {
            alert("Por favor, ingresa un número de cédula válido.");
            return;
        }
        cedulaActual = input.value;
        facturas = [];
        document.getElementById('form-cedula-area').style.display = "none";
        document.getElementById('panel-facturas').style.display = "block";
        document.getElementById('cedula-asociada').innerText = cedulaActual;
        anadirFactura();
    });

    // === Añadir otra factura (simula escaneo) ===
    document.getElementById('btnOtraFactura').addEventListener('click', anadirFactura);

    function anadirFactura() {
    if (typeof ejemplos === 'undefined' || !Array.isArray(ejemplos)) {
        alert("No hay datos de demo.js cargados.");
        return;
    }
    const ejemplo = ejemplos[Math.floor(Math.random() * ejemplos.length)];
    const factura = {...ejemplo, cedula: cedulaActual};
    facturas.push(factura);
    renderFacturas();
}

    // === Renderizar facturas ===
    function renderFacturas() {
        const lista = document.getElementById('factura-lista');
        lista.innerHTML = "";
        facturas.forEach((f, idx) => {
            const div = document.createElement('div');
            div.className = "factura-card";
            div.innerHTML = `
                <div class="campo"><b>#${idx+1} ${f.tienda ?? "(Sin tienda)"}</b></div>
                <div class="campo"><b>Titular:</b> ${f.titular ?? "-"}</div>
                <div class="campo"><b>Documento:</b> ${f.documento ?? "-"}</div>
                <div class="campo"><b>NIT:</b> ${f.NIT ?? "-"}</div>
                <div class="campo"><b>Fecha:</b> ${f.fecha_compra ?? "-"}</div>
                <div class="campo"><b>Valor:</b> $${f.valor_total ?? "-"}</div>
                <div class="campo"><b>Contacto:</b> ${f.contacto ?? "-"}</div>
                <div class="campo"><b>Prefijo:</b> ${f.prefijo ?? "-"}</div>
                <div class="campo"><b>Cédula asociada:</b> <span style="color:#267025">${f.cedula}</span></div>
            `;
            lista.appendChild(div);
        });
    }

    // === Confirmar y finalizar ===
    document.getElementById('btnFinalizar').addEventListener('click', () => {
        document.getElementById('panel-facturas').style.display = "none";
        document.getElementById('mensaje-exito').style.display = "block";
        // Limpieza para siguiente uso
        setTimeout(() => {
            document.getElementById('mensaje-exito').style.display = "none";
            document.getElementById('form-cedula-area').style.display = "flex";
            input.value = "";
            actualizarBotones();
        }, 4500);
    });

    // Inicial
    actualizarBotones();
</script>
</body>
</html>
